# Настройка страницы 404 для ibiza.ru

## Обзор
Настроена кастомная страница 404 с корректным HTTP статусом для сайта ibiza.ru.

## Компоненты решения

### 1. Astro страница 404
**Файл**: `src/pages/404.astro`

Страница включает:
- Понятное сообщение об ошибке
- Быстрые ссылки на главную страницу и статьи
- Список всех основных разделов сайта (отели, пляжи, рестораны, клубы, статьи, расписание вечеринок)
- Адаптивный дизайн с использованием Tailwind CSS
- SEO-мета тег `robots="noindex,follow"` для предотвращения индексации

### 2. Nginx конфигурация
**Файл**: `/etc/nginx/sites-available/ibiza-ru`

Ключевые изменения:
```nginx
# Кастомная страница 404 с правильным HTTP статусом
error_page 404 /404.html;
location = /404.html {
    internal;
}

# Обработка запросов - сначала ищем файл, затем директорию с index.html, иначе 404
location / {
    try_files $uri $uri/ =404;
}
```

**Важно**: Предыдущая конфигурация использовала `try_files $uri $uri/ /index.html`, что перенаправляло все несуществующие страницы на главную. Новая конфигурация корректно возвращает 404 страницу.

### 3. Статический файл
**Файл**: `dist/404.html`

Генерируется автоматически при сборке проекта Astro из `src/pages/404.astro`.

## Как это работает

1. Пользователь запрашивает несуществующую страницу (например, `/nonexistent-page`)
2. Nginx сначала ищет файл или директорию с таким именем
3. Если не находит, возвращает HTTP статус 404
4. Директива `error_page 404 /404.html` указывает nginx отдать содержимое `dist/404.html`
5. Директива `internal` предотвращает прямой доступ к `/404.html` извне
6. Пользователь видит красиво оформленную страницу с ошибкой и полезными ссылками

## Проверка работоспособности

Тестирование HTTP статуса:
```bash
curl -I https://ibiza.ru/nonexistent-page
# Должен вернуть: HTTP/2 404
```

Тестирование содержимого:
```bash
curl https://ibiza.ru/nonexistent-page
# Должен вернуть HTML с текстом "Страница не найдена"
```

## Обслуживание

### Редактирование страницы 404
1. Отредактируйте `src/pages/404.astro`
2. Пересоберите проект: `npm run build`
3. Новая версия автоматически будет использоваться nginx

### Восстановление предыдущей конфигурации
Резервная копия сохранена в `/etc/nginx/sites-available/ibiza-ru.backup`

```bash
cp /etc/nginx/sites-available/ibiza-ru.backup /etc/nginx/sites-available/ibiza-ru
nginx -t
systemctl reload nginx
```

## Дата настройки
06 января 2026
