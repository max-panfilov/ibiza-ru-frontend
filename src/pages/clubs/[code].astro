---
// src/pages/clubs/[code].astro

import SiteLayout from '../../layouts/SiteLayout.astro'
import Breadcrumbs from '@/shared/ui/Breadcrumbs.astro'
import { clubRepository } from '@/entities/club/api/clubRepository'
import { NotFoundError, logApiError } from '@/shared/api/errors'
import type { Club } from '@/entities/club/model/types'

// Генерация статических путей для SSG
export async function getStaticPaths() {
  try {
    const clubs = await clubRepository.getAll()
    return clubs.map((club) => ({
      params: { code: club.code },
      props: { club },
    }))
  } catch (error) {
    logApiError(error)
    return []
  }
}

const { club } = Astro.props as { club: Club }
---

<SiteLayout
  title={`${club.title} | Клубы | Ibiza.ru`}
  description={club.description}
  canonical={`https://ibiza.ru/clubs/${club.code}`}
>
  <div class="container mx-auto px-4 py-10">
    <div class="mb-6">
      <Breadcrumbs
        items={[
          { href: '/', label: 'Главная' },
          { href: '/clubs', label: 'Клубы' },
          { label: club.title },
        ]}
      />
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
      <div class="lg:col-span-1">
        <img
          src={club.coverImage?.url ?? '/placeholder.jpg'}
          alt={club.title}
          class="w-full rounded-2xl border border-base-200"
          loading="lazy"
        />
      </div>

      <div class="lg:col-span-2">
        <h1 class="text-3xl font-bold">{club.title}</h1>
        <p class="mt-2 text-base-content/70">{club.description}</p>

        <div class="mt-4 flex flex-wrap gap-2">
          {club.address ? <span class="badge badge-outline">{club.address}</span> : null}
          {club.priceRange ? <span class="badge badge-outline">{club.priceRange}</span> : null}
        </div>

        <div class="mt-8">
          <h2 class="text-xl font-semibold mb-3">События / детали (прототип)</h2>
          <p class="text-base-content/70 leading-7">
            Здесь будут вечеринки, расписание, билеты, карта и галерея.
          </p>
        </div>

        <div class="mt-8 flex gap-3">
          <button class="btn btn-primary">Смотреть вечеринки</button>
          <a class="btn btn-ghost" href="/clubs">Назад к списку</a>
        </div>
      </div>
    </div>
  </div>
</SiteLayout>
