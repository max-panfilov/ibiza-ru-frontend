---
// src/components/ImageCarousel.astro
// Карусель изображений на Embla (vanilla JS).
// Используем на детальных страницах отеля/ресторана для крупного фото + переключение.

export interface Props {
  id: string
  images: string[]
  alt?: string
}

const { id, images, alt = 'Фото' } = Astro.props
const safeImages = (images ?? []).filter(Boolean)
---

<div id={id} class="embla" data-embla>
  <!-- Большая галерея -->
  <div class="relative">
    <div class="embla__viewport overflow-hidden rounded-2xl border border-base-200 bg-base-200/20">
      <div class="embla__container flex">
        {safeImages.length === 0 ? (
          <div class="embla__slide flex-[0_0_100%] min-w-0">
            <div class="aspect-[16/9] md:aspect-[21/9] flex items-center justify-center text-base-content/60">
              Нет фото
            </div>
          </div>
        ) : (
          safeImages.map((src, idx) => (
            <div class="embla__slide flex-[0_0_100%] min-w-0">
              <img
                src={src}
                alt={`${alt} ${idx + 1}`}
                class="w-full aspect-[16/9] md:aspect-[21/9] object-cover"
                loading={idx === 0 ? 'eager' : 'lazy'}
              />
            </div>
          ))
        )}
      </div>
    </div>

    <!-- Премиальные контролы поверх изображения -->
    {safeImages.length > 1 ? (
      <>
        <button
          type="button"
          class="embla__prev btn btn-circle btn-sm absolute left-3 top-1/2 -translate-y-1/2 bg-black/40 border-white/20 text-white backdrop-blur hover:bg-black/60"
          aria-label="Предыдущее фото"
        >
          ‹
        </button>

        <button
          type="button"
          class="embla__next btn btn-circle btn-sm absolute right-3 top-1/2 -translate-y-1/2 bg-black/40 border-white/20 text-white backdrop-blur hover:bg-black/60"
          aria-label="Следующее фото"
        >
          ›
        </button>

        <div class="absolute inset-x-0 bottom-3 px-3">
          <div class="grid grid-cols-3 items-center">
            <div />

            <div class="embla__dots flex items-center justify-center gap-2" aria-label="Навигация по слайдам"></div>

            <div class="flex justify-end">
              <div class="embla__counter text-xs text-white bg-black/50 border border-white/10 px-2 py-1 rounded-full backdrop-blur" aria-label="Счётчик изображений">
                1 / 1
              </div>
            </div>
          </div>
        </div>
      </>
    ) : null}
  </div>

  <!-- Миниатюры (thumbs) -->
  {safeImages.length > 1 ? (
    <div class="mt-4 embla-thumbs">
      <div class="embla-thumbs__viewport overflow-hidden">
        <div class="embla-thumbs__container flex gap-3">
          {safeImages.map((src, idx) => (
            <div class="embla-thumbs__slide flex-[0_0_28%] sm:flex-[0_0_18%] md:flex-[0_0_14%] min-w-0">
              <button
                type="button"
                class="embla__thumb w-full overflow-hidden rounded-xl border border-base-200 ring-2 ring-transparent opacity-70 hover:opacity-100 transition"
                aria-label={`Открыть фото ${idx + 1}`}
              >
                <img src={src} alt={`${alt} миниатюра ${idx + 1}`} class="w-full aspect-[4/3] object-cover" loading="lazy" />
              </button>
            </div>
          ))}
        </div>
      </div>
    </div>
  ) : null}
</div>

<script>
  import { initEmblaCarousels } from '@/shared/ui/initEmblaCarousels'

  // Инициализация на клиенте; повторный вызов безопасен
  if (typeof window !== 'undefined') {
    initEmblaCarousels()
  }
</script>
