---
// src/components/FeaturedSection.astro
// Блок «Исследуйте Ибицу» с реальными объектами (отели, пляжи, рестораны, клубы).
// Вместо четырёх абстрактных плашек показываем по 3 случайных объекта каждой категории.

import EntityCard from '@/shared/ui/EntityCard.astro'
import { hotelRepository } from '@/entities/hotel/api/hotelRepository'
import { beachRepository } from '@/entities/beach/api/beachRepository'
import { restaurantRepository } from '@/entities/restaurant/api/restaurantRepository'
import { clubRepository } from '@/entities/club/api/clubRepository'
import { logApiError } from '@/shared/api/errors'

// Загружаем случайные сущности через репозитории доменного слоя
// Каждый репозиторий сам решает, как именно выбирать случайные записи (инкапсуляция логики)
let featuredHotels = []
let featuredBeaches = []
let featuredRestaurants = []
let featuredClubs = []

try {
  // Получаем до трёх случайных отелей
  featuredHotels = await hotelRepository.getRandom3()
} catch (error) {
  // Логируем ошибку, но не ломаем главную — просто не покажем блок категории
  logApiError(error)
}

try {
  // Получаем до трёх случайных пляжей
  featuredBeaches = await beachRepository.getRandom3()
} catch (error) {
  logApiError(error)
}

try {
  // Получаем до трёх случайных ресторанов
  featuredRestaurants = await restaurantRepository.getRandom3()
} catch (error) {
  logApiError(error)
}

try {
  // Получаем до трёх случайных клубов
  featuredClubs = await clubRepository.getRandom3()
} catch (error) {
  logApiError(error)
}
---

<div class="space-y-12">
  {featuredHotels.length > 0 && (
    <section class="container mx-auto px-4 py-10">
      <h2 class="text-4xl font-bold mb-8 text-center">Отели</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {featuredHotels.map((hotel: any) => (
          // Используем стандартную карточку сущности, как в списках
          <EntityCard entity={hotel} href={`/hotels/${hotel.code}`} />
        ))}
      </div>

      <div class="text-center mt-6">
        <a href="/hotels" class="btn btn-outline gap-2">
          <span>Все отели</span>
          <span aria-hidden="true">→</span>
        </a>
      </div>
    </section>
  )}

  {featuredBeaches.length > 0 && (
    <section class="container mx-auto px-4 py-10">
      <h2 class="text-4xl font-bold mb-8 text-center">Пляжи</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {featuredBeaches.map((beach: any) => (
          <EntityCard entity={beach} href={`/beaches/${beach.code}`} />
        ))}
      </div>

      <div class="text-center mt-6">
        <a href="/beaches" class="btn btn-outline gap-2">
          <span>Все пляжи</span>
          <span aria-hidden="true">→</span>
        </a>
      </div>
    </section>
  )}

  {featuredRestaurants.length > 0 && (
    <section class="container mx-auto px-4 py-10">
      <h2 class="text-4xl font-bold mb-8 text-center">Рестораны</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {featuredRestaurants.map((restaurant: any) => (
          <EntityCard entity={restaurant} href={`/restaurants/${restaurant.code}`} />
        ))}
      </div>

      <div class="text-center mt-6">
        <a href="/restaurants" class="btn btn-outline gap-2">
          <span>Все рестораны</span>
          <span aria-hidden="true">→</span>
        </a>
      </div>
    </section>
  )}

  {featuredClubs.length > 0 && (
    <section class="container mx-auto px-4 py-10">
      <h2 class="text-4xl font-bold mb-8 text-center">Клубы</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {featuredClubs.map((club: any) => (
          <EntityCard entity={club} href={`/clubs/${club.code}`} />
        ))}
      </div>

      <div class="text-center mt-6">
        <a href="/clubs" class="btn btn-outline gap-2">
          <span>Все клубы</span>
          <span aria-hidden="true">→</span>
        </a>
      </div>
    </section>
  )}
</div>
